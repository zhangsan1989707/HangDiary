# 日记应用优化需求对齐文档

## 原始需求分析

用户提出了6个核心优化需求：

1. **修复左上角菜单点击无响应问题** - 当前菜单点击无效，需要添加导航抽屉功能
2. **新增响应式待办功能** - 右下角添加待办图标，支持快速编写待办事项
3. **优化新建日记功能** - 移除心情、分类、天气字段，简化界面
4. **实现长按操作添加标签功能** - 通过长按日记项添加标签
5. **删除分类、天气相关内容** - 清理代码中相关逻辑
6. **新增README.md文件** - 项目文档完善

## 项目上下文分析

### 当前架构
- **技术栈**: Android Jetpack Compose + Room数据库
- **架构模式**: MVVM架构
- **导航**: Navigation Component
- **数据存储**: Room数据库，支持LocalDateTime
- **UI框架**: Material Design 3

### 现有功能模块
- 日记列表展示
- 日记详情编辑
- 分类管理
- 搜索功能
- 收藏/置顶功能
- 图片支持

### 当前问题识别
1. 左上角菜单点击无响应（DropdownMenu实现不完整）
2. 日记数据模型包含冗余字段（mood, weather, categoryId）
3. 缺少待办事项功能
4. 缺少标签管理功能
5. 缺少长按操作支持

## 需求理解确认

### 需求1: 导航抽屉功能
- **范围**: 替换现有DropdownMenu为NavigationDrawer
- **内容**: 全部日记、标签管理、待办、设置四个选项
- **交互**: 从左侧滑出，支持手势关闭

### 需求2: 待办功能
- **范围**: 新增待办事项实体和界面
- **位置**: 右下角悬浮按钮旁添加待办图标
- **功能**: 快速创建待办，支持标记完成状态

### 需求3: 日记简化
- **范围**: 移除心情、分类、天气字段
- **保留**: 标题、内容、创建时间
- **新增**: 自动显示日期格式"xxxx年X月x日星期X"

### 需求4: 标签功能
- **范围**: 长按日记项弹出标签管理
- **功能**: 添加/移除标签，支持多标签
- **交互**: 长按后显示标签选择对话框

### 需求5: 代码清理
- **范围**: 删除所有分类、天气相关代码
- **包含**: 数据模型、UI组件、ViewModel、Repository

### 需求6: 文档完善
- **范围**: 项目根目录README.md
- **内容**: 项目介绍、功能特性、技术栈、使用说明

## 疑问澄清

### 待确认事项
1. **待办功能复杂度**: 是否需要独立的待办数据库表？
   - 决策：创建独立的Todo实体，与日记分离

2. **标签系统设计**: 标签是全局的还是每篇日记独立？
   - 决策：全局标签系统，支持多对多关联

3. **数据迁移**: 删除字段后现有数据如何处理？
   - 决策：保留数据库字段但不再使用，避免数据丢失

4. **导航结构**: 新功能如何整合到现有导航？
   - 决策：扩展AppNavGraph，添加新路由

## 技术约束

### 必须遵循的规范
- 保持现有MVVM架构
- 使用Material Design 3设计语言
- 支持Android API 26+
- 保持Room数据库向后兼容
- 遵循现有代码风格

### 集成方案
1. **导航抽屉**: 使用ModalNavigationDrawer替换现有TopBar菜单
2. **待办功能**: 新增Todo数据模型和对应界面
3. **标签系统**: 新增Tag实体和中间表支持多对多关系
4. **UI优化**: 保持现有设计语言，简化新建日记界面

## 验收标准

### 功能验收
- [ ] 左侧导航抽屉正常响应手势操作
- [ ] 待办功能支持创建、编辑、完成标记
- [ ] 新建日记界面仅显示标题和内容
- [ ] 长按日记项弹出标签管理对话框
- [ ] 代码中无分类、天气相关残留
- [ ] README.md包含完整项目信息

### 技术验收
- [ ] 项目编译无警告
- [ ] 所有现有功能保持正常
- [ ] 新增功能有完整测试覆盖
- [ ] 数据库迁移无数据丢失
- [ ] 代码质量符合项目标准